name: Weather Update

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

permissions:
  contents: write  # ✅ Needed for pushing changes

jobs:
  update-weather:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install jq
        run: sudo apt-get install jq

      - name: Fetch weather and write to file
        run: |
          curl "https://api.openweathermap.org/data/2.5/weather?q=Lahore&appid=${{ secrets.WEATHER_API_KEY }}&units=metric" > weather.json
          CITY=$(jq -r '.name' weather.json)
          WEATHER=$(jq -r '.weather[0].description' weather.json)
          TEMP=$(jq -r '.main.temp' weather.json)
          echo "📍 Weather in $CITY: $WEATHER | 🌡 Temp: $TEMP°C" > WEATHER.md

      - name: Commit & push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add WEATHER.md
          git diff --cached --quiet || git commit -m "Update weather"
          git push
